import{ak as e,u as s,a,j as n,C as i,B as t,F as r,X as o,a3 as d,q as c,al as l,k as h,ab as x,T as u,ac as p,W as j,ad as m,D as g,a0 as b,am as f,an as v,ao as y,ap as w,aq as I,P as k,Q as S,x as C,ar as D,as as W,at as P,au as N,av as A,I as q,aw as R,ax as T,a5 as F,ay as B,V as z}from"./vendor.17cb6192.js";import{u as L,a as E}from"./index.5c90ee8a.js";import{I as $,E as U}from"./ExchangeStatusStepper.01ca9fbc.js";import"./firebase.99e0e815.js";const Y=({status:e})=>{switch(e){case"approved":return n.jsx(z,{icon:n.jsx(j,{}),label:"Approved",color:"success"});case"declined":return n.jsx(z,{icon:n.jsx(p,{}),label:"Declined",color:"error"});case"completed":return n.jsx(z,{icon:n.jsx(j,{}),label:"Completed",color:"success",sx:{bgcolor:"#9c27b0",color:"white"}});default:return n.jsx(z,{icon:n.jsx(x,{}),label:"Pending",color:"warning"})}},G=e=>{switch(e){case"new":return"New (with tags)";case"like_new":return"Like New (without tags)";case"very_good":return"Very Good (minimal wear)";case"good":return"Good (some signs of wear)";case"fair":return"Fair (visible wear)";case"poor":return"Poor (significant wear)";default:return e}};function O(){const{id:z}=e(),{currentUser:O}=L(),V=s(),[_,H]=a.useState(!0),[K,M]=a.useState(""),[Q,X]=a.useState(null),[J,Z]=a.useState(!1),[ee,se]=a.useState(!1),[ae,ne]=a.useState(!1),[ie,te]=a.useState(""),[re,oe]=a.useState(""),[de,ce]=a.useState(""),[le,he]=a.useState(""),[xe,ue]=a.useState(!1);a.useEffect((()=>{(async()=>{var e,s;try{H(!0),M("");const e=await O.getIdToken(),s=await E.get(`/api/exchange/${z}`,{headers:{Authorization:`Bearer ${e}`}});X(s.data);const n=s.data.shippingDetails;if(n){te(n.carrierName||""),oe(n.trackingNumber||"");let e="";try{const s=n.shippingDate?new Date(n.shippingDate):null;s&&!isNaN(s.getTime())&&(e=s.toISOString().split("T")[0])}catch(a){}ce(e),he(n.notes||"")}}catch(n){M((null==(s=null==(e=n.response)?void 0:e.data)?void 0:s.error)||"Failed to load exchange details")}finally{H(!1)}})()}),[z,O]);return _?n.jsx(i,{maxWidth:"md",sx:{mt:4},children:n.jsx(t,{sx:{display:"flex",justifyContent:"center",my:8},children:n.jsx(r,{})})}):Q?n.jsxs(i,{maxWidth:"md",sx:{mt:4},children:[K&&n.jsx(d,{severity:"error",sx:{mb:3},children:K}),n.jsx(t,{sx:{mb:2},children:n.jsx(c,{startIcon:n.jsx(l,{}),component:h,to:"/dashboard",children:"Back to Dashboard"})}),n.jsxs(o,{elevation:3,sx:{p:3,borderRadius:2,mb:3},children:["pending"===Q.status&&n.jsx(t,{sx:{mb:3},children:n.jsxs(t,{sx:{display:"flex",alignItems:"center",p:2,bgcolor:"#fff9c4",borderRadius:1},children:[n.jsx(x,{sx:{color:"warning.main",mr:1}}),n.jsx(u,{variant:"body1",children:"Your exchange request is currently under review."})]})}),"declined"===Q.status&&n.jsx(t,{sx:{mb:3},children:n.jsxs(t,{sx:{display:"flex",alignItems:"center",p:2,bgcolor:"#ffebee",borderRadius:1},children:[n.jsx(p,{sx:{color:"error.main",mr:1}}),n.jsx(u,{variant:"body1",children:"Your exchange request has been declined. Please check the admin feedback."})]})}),"approved"===Q.status&&!Q.shippingDetails&&!ae&&n.jsx(t,{sx:{mb:3},children:n.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:2,bgcolor:"#e8f5e9",borderRadius:1},children:[n.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[n.jsx(j,{sx:{color:"success.main",mr:1}}),n.jsx(u,{variant:"body1",children:"Your Exchange Request is Approved! Now add the shipping details."})]}),n.jsx(c,{size:"small",variant:"contained",color:"primary",startIcon:n.jsx(m,{}),onClick:()=>ne(!0),children:"Add Details"})]})}),n.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[n.jsx(u,{variant:"h5",component:"h1",children:"Exchange Request"}),n.jsx(Y,{status:Q.status})]}),n.jsx(g,{sx:{mb:3}}),n.jsxs(b,{container:!0,spacing:4,children:[n.jsx(b,{item:!0,xs:12,md:6,children:n.jsx(f,{component:o,variant:"outlined",children:n.jsx(v,{children:n.jsxs(y,{children:[n.jsxs(w,{children:[n.jsx(I,{component:"th",scope:"row",sx:{fontWeight:"bold"},children:"Product Name"}),n.jsx(I,{children:Q.productName})]}),n.jsxs(w,{children:[n.jsx(I,{component:"th",scope:"row",sx:{fontWeight:"bold"},children:"Brand"}),n.jsx(I,{children:Q.brand})]}),n.jsxs(w,{children:[n.jsx(I,{component:"th",scope:"row",sx:{fontWeight:"bold"},children:"Condition"}),n.jsx(I,{children:G(Q.condition)})]}),n.jsxs(w,{children:[n.jsx(I,{component:"th",scope:"row",sx:{fontWeight:"bold"},children:"Submitted"}),n.jsx(I,{children:new Date(Q.createdAt).toLocaleString()})]}),"pending"!==Q.status&&n.jsxs(w,{children:[n.jsx(I,{component:"th",scope:"row",sx:{fontWeight:"bold"},children:"Last Updated"}),n.jsx(I,{children:new Date(Q.updatedAt).toLocaleString()})]}),Q.shippingDetails&&n.jsxs(n.Fragment,{children:[n.jsxs(w,{children:[n.jsx(I,{component:"th",scope:"row",sx:{fontWeight:"bold"},children:"Shipping Carrier"}),n.jsx(I,{children:Q.shippingDetails.carrierName})]}),n.jsxs(w,{children:[n.jsx(I,{component:"th",scope:"row",sx:{fontWeight:"bold"},children:"Tracking Number"}),n.jsx(I,{children:Q.shippingDetails.trackingNumber})]}),n.jsxs(w,{children:[n.jsx(I,{component:"th",scope:"row",sx:{fontWeight:"bold"},children:"Shipping Date"}),n.jsx(I,{children:new Date(Q.shippingDetails.shippingDate).toLocaleDateString()})]})]}),Q.shippingDetails&&Q.warehouseInfo&&n.jsxs(w,{children:[n.jsx(I,{component:"th",scope:"row",sx:{fontWeight:"bold"},children:"Shipped To"}),n.jsxs(I,{children:[Q.warehouseInfo.name,", ",Q.warehouseInfo.city]})]})]})})})}),n.jsxs(b,{item:!0,xs:12,md:6,children:[n.jsx(u,{variant:"h6",gutterBottom:!0,children:"Product Description"}),n.jsx(u,{variant:"body1",paragraph:!0,children:Q.description}),n.jsx(t,{sx:{mt:3},children:n.jsx($,{images:Q.images||[],title:"Product Images",maxHeight:300,columns:2,emptyMessage:"No images available"})}),"approved"===Q.status&&Q.creditAmount>0&&n.jsx(k,{sx:{mt:3,bgcolor:"success.light"},children:n.jsxs(S,{children:[n.jsxs(t,{sx:{display:"flex",alignItems:"center",mb:1},children:[n.jsx(C,{sx:{mr:1,color:"success.dark"}}),n.jsx(u,{variant:"h6",component:"div",sx:{color:"success.dark"},children:"Credit Assigned"})]}),n.jsxs(u,{variant:"h4",component:"div",sx:{fontWeight:"bold",color:"success.dark"},children:["₹",Q.creditAmount.toFixed(2)]})]})}),Q.adminFeedback&&n.jsxs(t,{sx:{mt:3},children:[n.jsx(u,{variant:"h6",gutterBottom:!0,children:"Admin Feedback"}),n.jsx(o,{variant:"outlined",sx:{p:2,bgcolor:"#f8f9fa"},children:n.jsx(u,{variant:"body1",children:Q.adminFeedback})})]})]})]}),"pending"===Q.status&&n.jsxs(t,{sx:{mt:4},children:[n.jsx(g,{sx:{mb:3}}),J?n.jsxs(t,{sx:{bgcolor:"#fff1f0",p:3,borderRadius:1},children:[n.jsx(u,{variant:"subtitle1",gutterBottom:!0,children:"Are you sure you want to cancel this exchange request?"}),n.jsx(u,{variant:"body2",paragraph:!0,children:"This action cannot be undone."}),n.jsxs(t,{sx:{display:"flex",gap:2},children:[n.jsx(c,{variant:"outlined",onClick:()=>Z(!1),disabled:ee,children:"No, Keep Request"}),n.jsx(c,{variant:"contained",color:"error",onClick:async()=>{var e,s;try{se(!0);const e=await O.getIdToken();await E.delete(`/api/exchange/${z}`,{headers:{Authorization:`Bearer ${e}`}}),V("/dashboard")}catch(a){M((null==(s=null==(e=a.response)?void 0:e.data)?void 0:s.error)||"Failed to delete exchange request"),Z(!1)}finally{se(!1)}},disabled:ee,startIcon:ee?n.jsx(r,{size:20}):n.jsx(D,{}),children:"Yes, Cancel Request"})]})]}):n.jsx(t,{sx:{display:"flex",justifyContent:"flex-end"},children:n.jsx(c,{variant:"outlined",color:"error",startIcon:n.jsx(D,{}),onClick:()=>Z(!0),children:"Cancel Request"})})]})]}),"approved"===Q.status&&Q.warehouseInfo&&!Q.shippingDetails&&n.jsxs(o,{elevation:2,sx:{p:3,borderRadius:2,mb:3,bgcolor:"#f5f8ff"},children:[n.jsxs(u,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[n.jsx(W,{sx:{color:"info.main",mr:1}}),"Ship To This Address"]}),n.jsxs(t,{sx:{mt:2},children:[n.jsxs(b,{container:!0,spacing:2,children:[n.jsxs(b,{item:!0,xs:12,md:6,children:[n.jsx(u,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:Q.warehouseInfo.name}),n.jsx(u,{variant:"body1",children:Q.warehouseInfo.addressLine1}),Q.warehouseInfo.addressLine2&&n.jsx(u,{variant:"body1",children:Q.warehouseInfo.addressLine2}),n.jsxs(u,{variant:"body1",children:[Q.warehouseInfo.city,", ",Q.warehouseInfo.state," ",Q.warehouseInfo.postalCode]}),n.jsx(u,{variant:"body1",children:Q.warehouseInfo.country})]}),(Q.warehouseInfo.contactPerson||Q.warehouseInfo.contactPhone)&&n.jsxs(b,{item:!0,xs:12,md:6,children:[n.jsx(u,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:"Contact Information"}),Q.warehouseInfo.contactPerson&&n.jsx(u,{variant:"body1",children:Q.warehouseInfo.contactPerson}),Q.warehouseInfo.contactPhone&&n.jsxs(u,{variant:"body1",children:["Phone: ",Q.warehouseInfo.contactPhone]})]})]}),n.jsxs(d,{severity:"info",sx:{mt:3},children:[n.jsx(u,{variant:"body2",children:"Please ship your product to this address and add the shipping details below."}),n.jsx(c,{size:"small",variant:"outlined",color:"info",startIcon:n.jsx(m,{}),onClick:()=>ne(!0),sx:{mt:1},children:"Add Shipping Details"})]})]})]}),["approved","completed"].includes(Q.status)&&n.jsxs(o,{elevation:3,sx:{p:3,borderRadius:2,mb:3},children:[n.jsx(u,{variant:"h5",component:"h2",gutterBottom:!0,children:"Exchange Process"}),n.jsx(U,{exchange:Q,onShippingClick:()=>ne(!0)}),Q.creditAmount>0&&n.jsxs(t,{sx:{mt:3,p:2,bgcolor:"success.light",borderRadius:1},children:[n.jsxs(t,{sx:{display:"flex",alignItems:"center",mb:1},children:[n.jsx(P,{sx:{fontSize:24,color:"success.dark",mr:1}}),n.jsx(u,{variant:"subtitle1",color:"success.dark",fontWeight:"medium",children:"Credit Information"})]}),n.jsxs(u,{variant:"h5",component:"div",sx:{fontWeight:"bold",color:"success.dark",mb:1},children:["₹",Q.creditAmount.toFixed(2)]}),n.jsx(u,{variant:"body2",sx:{color:"success.dark"},children:"This credit has been added to your account and can be used on your next purchase."}),Q.totalShopifyCredit&&n.jsxs(u,{variant:"body2",sx:{mt:1,color:"success.dark"},children:["Total available store credit: ₹",Q.totalShopifyCredit.toFixed(2)]})]})]}),n.jsxs(N,{open:ae,onClose:()=>ne(!1),maxWidth:"md",fullWidth:!0,children:[n.jsxs(A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Submit Shipping Details",n.jsx(q,{edge:"end",onClick:()=>ne(!1),size:"small",children:n.jsx(R,{})})]}),n.jsx(T,{dividers:!0,children:n.jsxs(b,{container:!0,spacing:3,children:[n.jsx(b,{item:!0,xs:12,md:6,children:n.jsx(F,{label:"Carrier Name",value:ie,onChange:e=>te(e.target.value),fullWidth:!0,required:!0,margin:"normal",placeholder:"USPS, FedEx, UPS, etc."})}),n.jsx(b,{item:!0,xs:12,md:6,children:n.jsx(F,{label:"Tracking Number",value:re,onChange:e=>oe(e.target.value),fullWidth:!0,required:!0,margin:"normal"})}),n.jsx(b,{item:!0,xs:12,md:6,children:n.jsx(F,{label:"Shipping Date",type:"date",value:de,onChange:e=>ce(e.target.value),fullWidth:!0,required:!0,margin:"normal",InputLabelProps:{shrink:!0}})}),n.jsx(b,{item:!0,xs:12,children:n.jsx(F,{label:"Additional Notes (Optional)",value:le,onChange:e=>he(e.target.value),fullWidth:!0,multiline:!0,rows:3,margin:"normal"})})]})}),n.jsxs(B,{children:[n.jsx(c,{onClick:()=>ne(!1),disabled:xe,children:"Cancel"}),n.jsx(c,{variant:"contained",color:"primary",onClick:async e=>{var s,a;if(e.preventDefault(),ie&&re&&de)try{ue(!0),M("");const e=await O.getIdToken(),s=await E.post(`/api/exchange/${z}/shipping`,{carrierName:ie,trackingNumber:re,shippingDate:de,notes:le},{headers:{Authorization:`Bearer ${e}`}});X(s.data),ne(!1)}catch(n){M((null==(a=null==(s=n.response)?void 0:s.data)?void 0:a.error)||"Failed to submit shipping details")}finally{ue(!1)}else M("Please fill in all required shipping fields")},disabled:xe,startIcon:xe?n.jsx(r,{size:20,color:"inherit"}):n.jsx(m,{}),children:"Submit Shipping Details"})]})]})]}):n.jsx(i,{maxWidth:"md",sx:{mt:4},children:n.jsxs(o,{elevation:3,sx:{p:4,borderRadius:2},children:[n.jsx(d,{severity:"error",children:"Exchange request not found or you don't have permission to view it."}),n.jsx(t,{sx:{mt:3},children:n.jsx(c,{variant:"contained",startIcon:n.jsx(l,{}),component:h,to:"/dashboard",children:"Back to Dashboard"})})]})})}export{O as default};
