import{u as e,a,j as i,C as t,X as s,T as r,a3 as l,a0 as n,a5 as o,v as d,B as c,q as u,ag as m,F as p,a8 as h,P as x,ah as g,I as v,ai as j,aj as b,D as f}from"./vendor.17cb6192.js";import{u as y,a as w}from"./index.5c90ee8a.js";import"./firebase.99e0e815.js";const C=[{value:"new",label:"New (with tags)"},{value:"like_new",label:"Like New (without tags)"},{value:"very_good",label:"Very Good (minimal wear)"},{value:"good",label:"Good (some signs of wear)"},{value:"fair",label:"Fair (visible wear)"},{value:"poor",label:"Poor (significant wear)"}],q="dqduze7ep",S=`https://api.cloudinary.com/v1_1/${q}/image/upload`;function z(){const{currentUser:z}=y(),B=e(),[F,P]=a.useState({productName:"",brand:"",description:"",condition:"",images:[]}),[W,N]=a.useState(!1),[_,I]=a.useState(!1),[k,D]=a.useState(""),[$,R]=a.useState(""),M=e=>{const{name:a,value:i}=e.target;P((e=>({...e,[a]:i})))};return i.jsx(t,{maxWidth:"md",sx:{mt:4},children:i.jsxs(s,{elevation:3,sx:{p:4,borderRadius:2},children:[i.jsx(r,{variant:"h4",component:"h1",gutterBottom:!0,children:"Request a Product Exchange"}),i.jsx(r,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Please provide details about the product you'd like to exchange for store credit."}),k&&i.jsx(l,{severity:"error",sx:{mb:3},children:k}),i.jsxs("form",{onSubmit:async e=>{var a,i;if(e.preventDefault(),F.productName&&F.brand&&F.description&&F.condition)try{N(!0),D("");const e=await z.getIdToken(),a=await w.post("/api/exchange",F,{headers:{Authorization:`Bearer ${e}`}});B(`/exchange/${a.data.id}`)}catch(t){D((null==(i=null==(a=t.response)?void 0:a.data)?void 0:i.error)||"Failed to submit exchange request")}finally{N(!1)}else D("Please fill in all required fields")},children:[i.jsxs(n,{container:!0,spacing:3,children:[i.jsx(n,{item:!0,xs:12,children:i.jsx(o,{label:"Product Name",name:"productName",value:F.productName,onChange:M,fullWidth:!0,required:!0,variant:"outlined",placeholder:"e.g. Women's Summer Dress"})}),i.jsx(n,{item:!0,xs:12,md:6,children:i.jsx(o,{label:"Brand",name:"brand",value:F.brand,onChange:M,fullWidth:!0,required:!0,variant:"outlined",placeholder:"e.g. Zara"})}),i.jsx(n,{item:!0,xs:12,md:6,children:i.jsx(o,{select:!0,label:"Condition",name:"condition",value:F.condition,onChange:M,fullWidth:!0,required:!0,variant:"outlined",children:C.map((e=>i.jsx(d,{value:e.value,children:e.label},e.value)))})}),i.jsx(n,{item:!0,xs:12,children:i.jsx(o,{label:"Description",name:"description",value:F.description,onChange:M,fullWidth:!0,required:!0,variant:"outlined",multiline:!0,rows:4,placeholder:"Describe the product including size, color, material, and any other relevant details"})}),i.jsxs(n,{item:!0,xs:12,children:[i.jsx(r,{variant:"subtitle1",gutterBottom:!0,children:"Product Images"}),i.jsx(r,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Upload up to 5 clear photos of your product showing its condition (Max 5MB each)"}),$&&i.jsx(l,{severity:"error",sx:{mb:2},children:$}),i.jsxs(c,{sx:{mb:2},children:[i.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:async e=>{var a,i,t;const s=e.target.files;if(s&&0!==s.length)try{I(!0),R("");const e=Array.from(s).slice(0,5-F.images.length);for(const a of e){if(a.size>5242880){R(`File ${a.name} is too large. Max size is 5MB`);continue}if(!a.type.startsWith("image/")){R(`File ${a.name} is not an image`);continue}const e=new FormData;e.append("file",a),e.append("upload_preset","swapcred"),e.append("cloud_name",q);const i=await w.post(S,e,{headers:{"Content-Type":"multipart/form-data"}});i.data&&i.data.secure_url&&P((e=>({...e,images:[...e.images,{url:i.data.secure_url,publicId:i.data.public_id}]})))}}catch(r){R((null==(t=null==(i=null==(a=r.response)?void 0:a.data)?void 0:i.error)?void 0:t.message)||r.message||"Failed to upload image. Please try again.")}finally{I(!1),e.target.value=null}},style:{display:"none"},id:"image-upload-input",disabled:F.images.length>=5||_}),i.jsx("label",{htmlFor:"image-upload-input",children:i.jsx(u,{variant:"outlined",component:"span",startIcon:i.jsx(m,{}),disabled:F.images.length>=5||_,children:_?"Uploading...":"Upload Images"})}),_&&i.jsx(p,{size:24,sx:{ml:2}})]}),F.images.length>0&&i.jsx(h,{direction:"row",spacing:2,sx:{flexWrap:"wrap",gap:2},children:F.images.map(((e,a)=>i.jsxs(x,{sx:{width:100,position:"relative"},children:[i.jsx(g,{component:"img",height:"100",image:e.url,alt:`Product image ${a+1}`,sx:{objectFit:"cover"}}),i.jsx(v,{size:"small",sx:{position:"absolute",top:0,right:0,bgcolor:"rgba(0,0,0,0.5)",color:"white","&:hover":{bgcolor:"rgba(0,0,0,0.7)"}},onClick:()=>(e=>{P((a=>({...a,images:a.images.filter(((a,i)=>i!==e))})))})(a),children:i.jsx(j,{fontSize:"small"})})]},a)))}),0===F.images.length&&i.jsxs(c,{sx:{border:"1px dashed #ccc",borderRadius:1,p:3,textAlign:"center",color:"text.secondary"},children:[i.jsx(b,{sx:{fontSize:40,opacity:.5,mb:1}}),i.jsx(r,{variant:"body2",children:"No images uploaded yet"})]})]})]}),i.jsxs(c,{sx:{mt:4,display:"flex",justifyContent:"flex-end",gap:2},children:[i.jsx(u,{variant:"outlined",onClick:()=>B("/dashboard"),disabled:W,children:"Cancel"}),i.jsx(u,{type:"submit",variant:"contained",color:"primary",disabled:W||_,children:W?i.jsx(p,{size:24}):"Submit Request"})]})]}),i.jsx(f,{sx:{my:4}}),i.jsxs(c,{sx:{bgcolor:"#f5f5f5",p:3,borderRadius:1},children:[i.jsx(r,{variant:"subtitle1",gutterBottom:!0,children:"What happens next?"}),i.jsxs(r,{variant:"body2",component:"ul",sx:{pl:2},children:[i.jsx("li",{children:"Our team will review your exchange request"}),i.jsx("li",{children:"If approved, you'll receive instructions to ship your item"}),i.jsx("li",{children:"Once we receive and verify the product, we'll add credit to your account"}),i.jsx("li",{children:"You can use your credit on your next purchase"})]})]})]})})}export{z as default};
